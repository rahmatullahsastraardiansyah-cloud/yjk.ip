<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Menu - Kantin Online</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg">
        <div class="container">
            <a class="navbar-brand" href="index.html">
                <i class="fas fa-utensils"></i>
                Kantin Online
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon" style="filter: invert(1);"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto align-items-center" id="navMenu">
                    <!-- Dynamic menu -->
                </ul>
            </div>
        </div>
    </nav>

    <!-- Header -->
    <section class="py-4" style="background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%); color: white;">
        <div class="container">
            <h2 class="mb-0"><i class="fas fa-list me-2"></i>Daftar Menu</h2>
            <p class="mb-0 opacity-75">Temukan makanan dan minuman favoritmu</p>
        </div>
    </section>

    <!-- Filter & Search -->
    <section class="py-4">
        <div class="container">
            <div class="row g-3">
                <div class="col-md-6">
                    <div class="search-box">
                        <i class="fas fa-search"></i>
                        <input type="text" class="form-control" id="searchInput" placeholder="Cari menu...">
                    </div>
                </div>
                <div class="col-md-6">
                    <select class="form-select" id="kategoriFilter">
                        <option value="0">Semua Kategori</option>
                        <!-- Dynamic options -->
                    </select>
                </div>
            </div>
        </div>
    </section>

    <!-- Menu Grid -->
    <section class="py-4">
        <div class="container">
            <div class="row g-4" id="menuGrid">
                <!-- Dynamic menu -->
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-bottom">
                <p>&copy; 2024 Kantin Online. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/app.js"></script>
    <script>
        DB.init();
        const currentUser = Auth.getCurrentUser();
        
        // Get URL params
        const urlParams = new URLSearchParams(window.location.search);
        let kategoriFilter = parseInt(urlParams.get('kategori')) || 0;
        
        // Render navigation
        function renderNav() {
            const navMenu = document.getElementById('navMenu');
            let keranjangCount = 0;
            
            if (currentUser) {
                keranjangCount = DB.getKeranjang(currentUser.id).reduce((sum, k) => sum + k.jumlah, 0);
            }
            
            let html = `
                <li class="nav-item">
                    <a class="nav-link" href="index.html"><i class="fas fa-home"></i> Beranda</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link active" href="menu.html"><i class="fas fa-list"></i> Menu</a>
                </li>
            `;
            
            if (currentUser) {
                html += `
                    <li class="nav-item">
                        <a class="nav-link" href="riwayat.html"><i class="fas fa-history"></i> Riwayat</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="profil.html"><i class="fas fa-user"></i> Profil</a>
                    </li>
                    <li class="nav-item ms-2">
                        <a href="keranjang.html" class="btn btn-light position-relative">
                            <i class="fas fa-shopping-cart"></i>
                            ${keranjangCount > 0 ? `
                                <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
                                    ${keranjangCount}
                                </span>
                            ` : ''}
                        </a>
                    </li>
                    <li class="nav-item ms-2">
                        <button onclick="logout()" class="btn btn-outline-light">
                            <i class="fas fa-sign-out-alt"></i>
                        </button>
                    </li>
                `;
            } else {
                html += `
                    <li class="nav-item ms-2">
                        <a href="login.html" class="btn btn-light">
                            <i class="fas fa-sign-in-alt me-1"></i> Login
                        </a>
                    </li>
                `;
            }
            
            navMenu.innerHTML = html;
        }
        
        // Render kategori filter
        function renderKategoriFilter() {
            const kategories = DB.getKategori();
            const select = document.getElementById('kategoriFilter');
            
            kategories.forEach(kat => {
                const option = document.createElement('option');
                option.value = kat.id;
                option.textContent = kat.nama;
                if (kat.id === kategoriFilter) option.selected = true;
                select.appendChild(option);
            });
            
            select.addEventListener('change', function() {
                kategoriFilter = parseInt(this.value);
                renderMenu();
            });
        }
        
        // Render menu
        function renderMenu(search = '') {
            let menus = DB.getMenu().filter(m => m.status === 'tersedia');
            
            if (kategoriFilter > 0) {
                menus = menus.filter(m => m.kategori_id === kategoriFilter);
            }
            
            if (search) {
                menus = menus.filter(m => m.nama.toLowerCase().includes(search.toLowerCase()));
            }
            
            const container = document.getElementById('menuGrid');
            
            if (menus.length === 0) {
                container.innerHTML = `
                    <div class="col-12 text-center">
                        <div class="empty-state">
                            <i class="fas fa-search"></i>
                            <h4>Menu tidak ditemukan</h4>
                            <p>Coba kata kunci lain atau pilih kategori berbeda</p>
                        </div>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = menus.map(menu => `
                <div class="col-6 col-md-4 col-lg-3 menu-item" data-nama="${menu.nama.toLowerCase()}">
                    <div class="card menu-card h-100">
                        <div class="card-img-wrapper">
                            <span class="kategori-badge">${DB.getKategori().find(k => k.id === menu.kategori_id)?.nama || ''}</span>
                            <img src="${menu.gambar}" alt="${menu.nama}" loading="lazy">
                            ${menu.stok <= 0 ? '<div class="stok-habis">STOK HABIS</div>' : ''}
                        </div>
                        <div class="card-body">
                            <h5 class="nama-menu">${menu.nama}</h5>
                            <p class="deskripsi">${menu.deskripsi}</p>
                            <div class="d-flex justify-content-between align-items-center mt-3">
                                <span class="harga">${rupiah(menu.harga)}</span>
                                ${menu.stok > 0 && currentUser ? `
                                    <button class="btn btn-primary btn-sm" onclick="tambahKeranjang(${menu.id})">
                                        <i class="fas fa-plus"></i>
                                    </button>
                                ` : !currentUser ? `
                                    <a href="login.html" class="btn btn-outline-primary btn-sm">
                                        <i class="fas fa-sign-in-alt"></i>
                                    </a>
                                ` : ''}
                            </div>
                            <small class="text-muted">Stok: ${menu.stok}</small>
                        </div>
                    </div>
                </div>
            `).join('');
        }
        
        // Tambah keranjang
        function tambahKeranjang(menuId) {
            if (!currentUser) {
                window.location.href = 'login.html';
                return;
            }
            
            const menu = DB.getMenuById(menuId);
            if (menu.stok <= 0) {
                showToast('Stok habis!', 'danger');
                return;
            }
            
            DB.addToKeranjang(currentUser.id, menuId, 1);
            showToast('Menu ditambahkan ke keranjang!');
            renderNav();
        }
        
        // Logout
        function logout() {
            Auth.logout();
        }
        
        // Search functionality
        document.getElementById('searchInput').addEventListener('input', function() {
            renderMenu(this.value);
        });
        
        // Initialize
        renderNav();
        renderKategoriFilter();
        renderMenu();
    </script>
</body>
</html>
