<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kelola Menu - Admin Kantin Online</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="admin-sidebar">
        <div class="logo">
            <i class="fas fa-utensils d-block"></i>
            <h4>Kantin Online</h4>
            <small class="text-muted">Admin Panel</small>
        </div>
        <nav class="nav flex-column">
            <a class="nav-link" href="admin.html">
                <i class="fas fa-tachometer-alt"></i> Dashboard
            </a>
            <a class="nav-link active" href="admin-menu.html">
                <i class="fas fa-utensils"></i> Kelola Menu
            </a>
            <a class="nav-link" href="admin-pengguna.html">
                <i class="fas fa-users"></i> Pengguna
            </a>
            <a class="nav-link" href="admin-penghasilan.html">
                <i class="fas fa-chart-line"></i> Penghasilan
            </a>
            <a class="nav-link" href="index.html">
                <i class="fas fa-home"></i> Ke Beranda
            </a>
            <a class="nav-link" href="#" onclick="logout()">
                <i class="fas fa-sign-out-alt"></i> Logout
            </a>
        </nav>
    </div>

    <div class="admin-content">
        <h2 class="mb-4"><i class="fas fa-utensils me-2 text-primary"></i>Kelola Menu</h2>

        <div id="alert-container"></div>

        <div class="card mb-4">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">Daftar Menu</h5>
                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#modalTambah">
                    <i class="fas fa-plus me-2"></i>Tambah Menu
                </button>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-hover mb-0">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Nama Menu</th>
                                <th>Kategori</th>
                                <th>Harga</th>
                                <th>Stok</th>
                                <th>Status</th>
                                <th>Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="menuTable">
                            <!-- Dynamic -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Tambah -->
    <div class="modal fade" id="modalTambah" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Tambah Menu Baru</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <form id="formTambah">
                    <div class="modal-body">
                        <div class="mb-3">
                            <label class="form-label">Nama Menu</label>
                            <input type="text" name="nama" class="form-control" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Kategori</label>
                            <select name="kategori_id" class="form-select" id="selectKategori" required>
                                <!-- Dynamic -->
                            </select>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Harga</label>
                                <input type="number" name="harga" class="form-control" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Stok</label>
                                <input type="number" name="stok" class="form-control" required>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Deskripsi</label>
                            <textarea name="deskripsi" class="form-control" rows="3"></textarea>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">URL Gambar</label>
                            <input type="url" name="gambar" class="form-control" placeholder="https://...">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Status</label>
                            <select name="status" class="form-select">
                                <option value="tersedia">Tersedia</option>
                                <option value="habis">Habis</option>
                            </select>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                        <button type="submit" class="btn btn-primary">Simpan</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal Edit -->
    <div class="modal fade" id="modalEdit" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Edit Menu</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <form id="formEdit">
                    <input type="hidden" name="id" id="editId">
                    <div class="modal-body">
                        <div class="mb-3">
                            <label class="form-label">Nama Menu</label>
                            <input type="text" name="nama" id="editNama" class="form-control" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Kategori</label>
                            <select name="kategori_id" id="editKategori" class="form-select" required>
                                <!-- Dynamic -->
                            </select>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Harga</label>
                                <input type="number" name="harga" id="editHarga" class="form-control" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Stok</label>
                                <input type="number" name="stok" id="editStok" class="form-control" required>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Deskripsi</label>
                            <textarea name="deskripsi" id="editDeskripsi" class="form-control" rows="3"></textarea>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">URL Gambar</label>
                            <input type="url" name="gambar" id="editGambar" class="form-control">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Status</label>
                            <select name="status" id="editStatus" class="form-select">
                                <option value="tersedia">Tersedia</option>
                                <option value="habis">Habis</option>
                            </select>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                        <button type="submit" class="btn btn-primary">Simpan Perubahan</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/app.js"></script>
    <script>
        // Check admin
        if (!Auth.isLoggedIn() || !Auth.isAdmin()) {
            window.location.href = 'index.html';
        }
        
        DB.init();
        
        // Render kategori options
        function renderKategoriOptions(selectId, selectedId = null) {
            const kategories = DB.getKategori();
            const select = document.getElementById(selectId);
            select.innerHTML = kategories.map(k => 
                `<option value="${k.id}" ${selectedId === k.id ? 'selected' : ''}>${k.nama}</option>`
            ).join('');
        }
        
        // Render menu table
        function renderMenu() {
            const menu = DB.getMenu().sort((a, b) => b.id - a.id);
            const tbody = document.getElementById('menuTable');
            
            tbody.innerHTML = menu.map(m => {
                const kategori = DB.getKategori().find(k => k.id === m.kategori_id);
                return `
                    <tr>
                        <td>${m.id}</td>
                        <td>${m.nama}</td>
                        <td>${kategori ? kategori.nama : '-'}</td>
                        <td>${rupiah(m.harga)}</td>
                        <td>${m.stok}</td>
                        <td>
                            <span class="badge bg-${m.status === 'tersedia' ? 'success' : 'danger'}">
                                ${m.status === 'tersedia' ? 'Tersedia' : 'Habis'}
                            </span>
                        </td>
                        <td>
                            <button class="btn btn-sm btn-warning" onclick="editMenu(${m.id})">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="hapusMenu(${m.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `;
            }).join('');
        }
        
        // Tambah menu
        document.getElementById('formTambah').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const data = {
                nama: this.nama.value,
                kategori_id: parseInt(this.kategori_id.value),
                harga: parseInt(this.harga.value),
                stok: parseInt(this.stok.value),
                deskripsi: this.deskripsi.value,
                gambar: this.gambar.value || 'https://images.unsplash.com/photo-1546069901-ba9599a7e63c?w=400',
                status: this.status.value
            };
            
            DB.addMenu(data);
            showToast('Menu berhasil ditambahkan!');
            
            bootstrap.Modal.getInstance(document.getElementById('modalTambah')).hide();
            this.reset();
            renderMenu();
        });
        
        // Edit menu
        function editMenu(id) {
            const menu = DB.getMenuById(id);
            if (!menu) return;
            
            document.getElementById('editId').value = menu.id;
            document.getElementById('editNama').value = menu.nama;
            document.getElementById('editHarga').value = menu.harga;
            document.getElementById('editStok').value = menu.stok;
            document.getElementById('editDeskripsi').value = menu.deskripsi;
            document.getElementById('editGambar').value = menu.gambar;
            document.getElementById('editStatus').value = menu.status;
            
            renderKategoriOptions('editKategori', menu.kategori_id);
            
            new bootstrap.Modal(document.getElementById('modalEdit')).show();
        }
        
        // Update menu
        document.getElementById('formEdit').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const id = parseInt(document.getElementById('editId').value);
            const data = {
                nama: document.getElementById('editNama').value,
                kategori_id: parseInt(document.getElementById('editKategori').value),
                harga: parseInt(document.getElementById('editHarga').value),
                stok: parseInt(document.getElementById('editStok').value),
                deskripsi: document.getElementById('editDeskripsi').value,
                gambar: document.getElementById('editGambar').value,
                status: document.getElementById('editStatus').value
            };
            
            DB.updateMenu(id, data);
            showToast('Menu berhasil diperbarui!');
            
            bootstrap.Modal.getInstance(document.getElementById('modalEdit')).hide();
            renderMenu();
        });
        
        // Hapus menu
        function hapusMenu(id) {
            if (confirm('Yakin ingin menghapus menu ini?')) {
                DB.deleteMenu(id);
                showToast('Menu berhasil dihapus!');
                renderMenu();
            }
        }
        
        function logout() {
            Auth.logout();
        }
        
        // Initialize
        renderKategoriOptions('selectKategori');
        renderMenu();
    </script>
</body>
</html>
